<!doctype html>
<html lang="en">
<%- include('../partials/Header') %>
<style>
    /* Ensure package images are 365x305 pixels */
    .package-wrap .feature-image {
        width: 365px;
        height: 305px;
        overflow: hidden;
    }
    .package-wrap .feature-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        object-position: center;
    }
    .review-area {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 0.75rem;
    }
    .review-text {
        font-size: 0.9rem;
        color: #555555;
    }
    .rating-start {
        font-size: 1rem;
        color: #ccc;
        display: inline-flex;
    }
    .rating-start i {
        margin: 0 0.2px;
    }
    .rating-start .filled {
        color: #f5c518;
    }
    .wishlist-toggle {
        color: #dc3545;
        text-decoration: none;
        font-size: 0.9rem;
    }
    .wishlist-toggle:hover {
        text-decoration: underline;
    }
</style>
<body>
    <%- include('../partials/Loader') %>
    <div id="page" class="full-page">
        <%- include('../partials/Navbar.ejs') %>
        <main id="content" class="site-main">
            <!-- Inner Banner -->
            <section class="inner-banner-wrap">
                <div class="inner-baner-container" style="background-image: url(/assets/images/inner-banner.jpg);">
                    <div class="container">
                        <div class="inner-banner-content">
                            <h1 class="inner-title">Tour Packages</h1>
                        </div>
                    </div>
                </div>
                <div class="inner-shape"></div>
            </section>
            <!-- packages html start -->
            <div class="package-section">
                <div class="container">
                    <div class="package-inner">
                        <div class="row">
                            <% if (packages.length === 0) { %>
                                <div class="col-12 text-center">
                                    <h3>No packages available</h3>
                                    <p>Currently, there are no active tour packages available. Please check back later or explore other destinations.</p>
                                </div>
                            <% } else { %>
                                <% packages.forEach(function(package) { %>
                                    <% if (package.status === 'Active') { %>
                                        <div class="col-lg-4 col-md-6">
                                            <div class="package-wrap">
                                                <figure class="feature-image">
                                                    <a href="/package-detail/<%= package._id %>">
                                                        <img src="/Uploads/gallery/<%= package.featuredImage || 'default.jpg' %>" alt="<%= package.title %>">
                                                    </a>
                                                </figure>
                                                <div class="package-price">
                                                    <h6>
                                                        <span>$<%= package.salePrice || package.regularPrice %></span> / per person
                                                    </h6>
                                                </div>
                                                <div class="package-content-wrap">
                                                    <div class="package-meta text-center">
                                                        <ul>
                                                            <li>
                                                                <i class="far fa-clock"></i>
                                                                <%= package.tripDuration.days %>D/<%= package.tripDuration.nights %>N
                                                            </li>
                                                            <li>
                                                                <i class="fas fa-user-friends"></i>
                                                                People: <%= package.groupSize || 'N/A' %>
                                                            </li>
                                                            <li>
                                                                <i class="fas fa-map-marker-alt"></i>
                                                                <%= package.destinationCountry || 'N/A' %>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                    <div class="package-content">
                                                        <h3>
                                                            <a href="/package-detail/<%= package._id %>"><%= package.title %></a>
                                                        </h3>
                                                        <div class="review-area">
                                                            <span class="review-text">(<%= package.reviewCount || 0 %> reviews)</span>
                                                            <div class="rating-start" title="Rated <%= package.averageRating || 0 %> out of 5">
                                                                <% for (let i = 1; i <= 5; i++) { %>
                                                                    <i class="fas fa-star <%= i <= Math.round(package.averageRating || 0) ? 'filled' : '' %>"></i>
                                                                <% } %>
                                                            </div>
                                                        </div>
                                                        <p><%= package.description?.substring(0, 100) %>...</p>
                                                        <div class="btn-wrap">
                                                            <a href="/bookPackage/<%= package._id %>" class="button-text width-6">Book Now<i class="fas fa-arrow-right"></i></a>
                                                            <a href="#" class="wishlist-toggle button-text width-6" data-package-id="<%= package._id %>" data-is-wishlisted="<%= package.isWishlisted %>">
                                                                <%= package.isWishlisted ? 'Remove' : 'Wish List' %>
                                                                <i class="<%= package.isWishlisted ? 'fas fa-heart' : 'far fa-heart' %>"></i>
                                                            </a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    <% } %>
                                <% }) %>
                            <% } %>
                        </div>
                    </div>
                </div>
            </div>
            <!-- packages html end -->
            <!-- Home activity section -->
            <section class="activity-section">
                <div class="container">
                    <div class="section-heading text-center">
                        <div class="row">
                            <div class="col-lg-8 offset-lg-2">
                                <h5 class="dash-style">TRAVEL BY ACTIVITY</h5>
                                <h2>ADVENTURE & ACTIVITY</h2>
                                <p>Mollit voluptatem perspiciatis convallis elementum corporis quo veritatis aliquid blandit, blandit torquent, odit placeat. Adipiscing repudiandae eius cursus? Nostrum magnis maxime curae placeat.</p>
                            </div>
                        </div>
                    </div>
                    <div class="activity-inner row">
                        <div class="col-lg-2 col-md-4 col-sm-6">
                            <div class="activity-item">
                                <div class="activity-icon">
                                    <a href="#"><img src="/assets/images/icon6.png" alt=""></a>
                                </div>
                                <div class="activity-content">
                                    <h4><a href="#">Adventure</a></h4>
                                    <p>15 Destination</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-2 col-md-4 col-sm-6">
                            <div class="activity-item">
                                <div class="activity-icon">
                                    <a href="#"><img src="/assets/images/icon10.png" alt=""></a>
                                </div>
                                <div class="activity-content">
                                    <h4><a href="#">Trekking</a></h4>
                                    <p>12 Destination</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-2 col-md-4 col-sm-6">
                            <div class="activity-item">
                                <div class="activity-icon">
                                    <a href="#"><img src="/assets/images/icon9.png" alt=""></a>
                                </div>
                                <div class="activity-content">
                                    <h4><a href="#">Camp Fire</a></h4>
                                    <p>7 Destination</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-2 col-md-4 col-sm-6">
                            <div class="activity-item">
                                <div class="activity-icon">
                                    <a href="#"><img src="/assets/images/icon8.png" alt=""></a>
                                </div>
                                <div class="activity-content">
                                    <h4><a href="#">Off Road</a></h4>
                                    <p>15 Destination</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-2 col-md-4 col-sm-6">
                            <div class="activity-item">
                                <div class="activity-icon">
                                    <a href="#"><img src="/assets/images/icon7.png" alt=""></a>
                                </div>
                                <div class="activity-content">
                                    <h4><a href="#">Camping</a></h4>
                                    <p>13 Destination</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-2 col-md-4 col-sm-6">
                            <div class="activity-item">
                                <div class="activity-icon">
                                    <a href="#"><img src="/assets/images/icon11.png" alt=""></a>
                                </div>
                                <div class="activity-content">
                                    <h4><a href="#">Exploring</a></h4>
                                    <p>25 Destination</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
        <%- include('../partials/Footer.ejs') %>
    </div>
    <%- include('../../shared/partials/toaster') %>

    <%- include('../partials/Script.ejs') %>
    <!-- Dependencies -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Destination filter
            const urlParams = new URLSearchParams(window.location.search);
            const selectedDestination = urlParams.get('destination');
            if (selectedDestination) {
                const packageWraps = document.querySelectorAll('.package-wrap');
                packageWraps.forEach(wrap => {
                    const country = wrap.querySelector('.package-meta li:last-child').textContent.trim();
                    if (!country.toUpperCase().includes(selectedDestination.toUpperCase())) {
                        wrap.parentElement.style.display = 'none';
                    }
                });
            }

            // Handle wishlist toggle
            document.querySelectorAll('.wishlist-toggle').forEach(button => {
                button.addEventListener('click', async (e) => {
                    e.preventDefault();
                    const packageId = button.getAttribute('data-package-id');
                    const isWishlisted = button.getAttribute('data-is-wishlisted') === 'true';
                    const action = isWishlisted ? 'remove' : 'add';

                    try {
                        const response = await fetch(`/wishlist/${action}/${packageId}`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                        });
                        const data = await response.json();

                        if (response.ok) {
                            window.location.reload()
                            button.setAttribute('data-is-wishlisted', !isWishlisted);
                            button.innerHTML = isWishlisted 
                            ? 'Wish List<i class="far fa-heart"></i>' 
                                : 'Remove<i class="fas fa-heart"></i>';
                        } else {

                        }
                    } catch (error) {
                        console.error(`Error ${action}ing package to wishlist:`, error);
 
                    }
                });
            });
        });
    </script>
</body>
</html>