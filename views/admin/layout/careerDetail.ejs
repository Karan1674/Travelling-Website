<!doctype html>
<html lang="en">
<%- include('../partials/Header') %>
<body>
    <div id="container-wrapper">
        <div id="dashboard" class="dashboard-container">
            <%- include('../partials/Navbar') %>
            <%- include('../partials/Sidebar') %>
            <div class="db-info-wrap">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="dashboard-box" style="background: #fff; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.15); padding: 20px;">
                            <div class="header-controls" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                                <h4 style="margin: 0; color: #333; font-size: 24px; font-weight: 600;">Career Detail</h4>
                                <div>
                                    <a href="/edit-career/<%= career._id %>" class="btn btn-primary" style="margin-right: 10px; padding: 8px 16px;" aria-label="Edit career">Edit</a>
                                    <a href="/career-list" class="btn btn-secondary" style="padding: 8px 16px;" aria-label="Back to career list">Back to List</a>
                                </div>
                            </div>
   
                            <div class="card" style="border: 1px solid #e0e0e0; border-radius: 10px; padding: 25px; background: #fafafa;">
                                <div class="row">
                                    <div class="col-md-6">
                                        <p style="margin-bottom: 12px;"><strong style="color: #333;">Title:</strong> <%= career.title %></p>
                                        <p style="margin-bottom: 12px;"><strong style="color: #333;">Employment Type:</strong> <%= career.employmentType %></p>
                                        <p style="margin-bottom: 12px;"><strong style="color: #333;">Vacancies:</strong> <%= career.vacancies %></p>
                                        <p style="margin-bottom: 12px;"><strong style="color: #333;">Salary:</strong> <%= career.salary %></p>
                                        <p style="margin-bottom: 12px;"><strong style="color: #333;">Active:</strong> <%= career.isActive ? 'Yes' : 'No' %></p>
                                        <p style="margin-bottom: 12px;"><strong style="color: #333;">Created By:</strong> <%= career.createdBy? `${career.createdBy.firstName} ${career.createdBy.lastName}` : 'Unknown' %> (<%= career.createdBy?.email || 'N/A' %>)</p>
                                    
                                    
                                            <% if(career.updatedBy) {%>        <p style="margin-bottom: 12px;"><strong style="color: #333;">Updated By:</strong> <%= career.updatedBy? `${career.updatedBy.firstName} ${career.updatedBy.lastName}` : 'Unknown' %> (<%= career.updatedBy?.email || 'N/A' %>)</p>  <% } %>
                                            <% if(career.updatedAt) {%>                  <p style="margin-bottom: 12px;"><strong style="color: #333;">Updated At:</strong> <%= career.updatedAt? `${career.updatedAt.toISOString().split('T')[0]}` : '-' %></p>   <% } %>

                                    </div>
                                    <div class="col-md-6 text-center">
                                        <img src="/uploads/career/<%= career.image %>" alt="<%= career.title %>" style="max-width: 100%; max-height: 300px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <h5 style="color: #333; font-weight: 600; margin-bottom: 15px;">Short Description</h5>
                                    <p style="color: #555;"><%= career.shortDescription %></p>
                                </div>
                                <div class="mt-4">
                                    <h5 style="color: #333; font-weight: 600; margin-bottom: 15px;">Description</h5>
                                    <div style="color: #555;"><%- career.description %></div>
                                </div>
                                <div class="mt-4">
                                    <h5 style="color: #333; font-weight: 600; margin-bottom: 15px;">Overview</h5>
                                    <div style="color: #555;"><%- career.overview %></div>
                                </div>
                                <div class="mt-4">
                                    <h5 style="color: #333; font-weight: 600; margin-bottom: 15px;">Experience</h5>
                                    <div style="color: #555; padding: 10px;"><%- career.experience %></div>
                                </div>
                                <div class="mt-4">
                                    <h5 style="color: #333; font-weight: 600; margin-bottom: 15px;">Requirements</h5>
                                    <div style="color: #555;"><%- career.requirements %></div>
                                </div>
                            </div>
                            <!-- Applicants Table -->
                            <div class="mt-5">
                                <h4 style="color: #333; font-weight: 600; margin-bottom: 20px;">Applicants</h4>
                                <div class="table-responsive">
                                    <table class="table table-bordered table-hover" style="background: #fff; border-radius: 8px;">
                                        <thead style="background: #f1f1f1;">
                                            <tr>
                                                <th>Name</th>
                                                <th>Email</th>
                                                <th>CV</th>
                                                <th>Status</th>
                                                <th>Applied At</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <% if (applications && applications.length > 0) { %>
                                                <% applications.forEach(application => { %>
                                                    <tr>
                                                        <td><%= application.userId? `${application.userId.firstName} ${application.userId.lastName}` : 'Unknown' %></td>
                                                        <td><%= application.userId?.email || 'N/A' %></td>
                                                        <td>
                                                            <% if (application.cvFileName) { %>
                                                                <a href="/uploads/careerCV/<%= application.cvFileName %>" target="_blank" class="text-primary">View CV</a>
                                                            <% } else { %>
                                                                No CV
                                                            <% } %>
                                                        </td>
                                                        <td>
                                                            <span class="badge" style="padding: 6px 12px; border-radius: 12px; <%= application.status === 'accepted' ? 'background: #28a745; color: #fff;' : application.status === 'rejected' ? 'background: #dc3545; color: #fff;' : 'background: #ffc107; color: #333;' %>">
                                                                <%= application.status.charAt(0).toUpperCase() + application.status.slice(1) %>
                                                            </span>
                                                        </td>
                                                        <td><%= new Date(application.appliedAt).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' }) %></td>
                                                        <td>
                                                            <a href="/application-detail/<%= application._id %>" class="btn btn-sm  text-white btn-info">View & Edit</a>
                                                        </td>
                                                    </tr>
                                                <% }) %>
                                            <% } else { %>
                                                <tr>
                                                    <td colspan="6" class="text-center">No applicants found for this career.</td>
                                                </tr>
                                            <% } %>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <%- include('../partials/Footer') %>
        </div>
    </div>
    <%- include('../../shared/partials/toaster') %>
    <%- include('../partials/script.ejs') %>
</body>
</html>