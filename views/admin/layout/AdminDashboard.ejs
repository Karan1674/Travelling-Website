<!doctype html>
<html lang="en">
<%- include('../partials/Header')%>
<body>
    <!-- start Container Wrapper -->
    <div id="container-wrapper">
        <!-- Dashboard -->
        <div id="dashboard" class="dashboard-container">
            <%- include('../partials/Navbar')%>
            <%- include('../partials/Sidebar')%>
            <div class="db-info-wrap">
                <div class="row">
                    <!-- Item -->
                    <div class="col-xl-3 col-sm-6">
                        <div class="db-info-list">
                            <div class="dashboard-stat-icon bg-blue">
                                <i class="fas fa-user-shield"></i>
                            </div>
                            <div class="dashboard-stat-content">
                                <h4>Agents</h4>
                                <h5><%= agentCount.toLocaleString() %></h5>
                            </div>
                        </div>
                    </div>
                    <!-- Item -->
                    <div class="col-xl-3 col-sm-6">
                        <div class="db-info-list">
                            <div class="dashboard-stat-icon bg-purple">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="dashboard-stat-content">
                                <h4>Users</h4>
                                <h5><%= usersCount.toLocaleString() %></h5>
                            </div>
                        </div>
                    </div>
                    <!-- Item -->
                    <div class="col-xl-3 col-sm-6">
                        <div class="db-info-list">
                            <div class="dashboard-stat-icon bg-green">
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                            <div class="dashboard-stat-content">
                                <h4>Product Earnings</h4>
                                <h5>$<%= productEarnings.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) %></h5>
                            </div>
                        </div>
                    </div>
                    <!-- Item -->
                    <div class="col-xl-3 col-sm-6">
                        <div class="db-info-list">
                            <div class="dashboard-stat-icon bg-green">
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                            <div class="dashboard-stat-content">
                                <h4>Package Earnings</h4>
                                <h5>$<%= packageEarnings.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) %></h5>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-12">
                        <div class="dashboard-box">
                            <h4>Recent Bookings</h4>
                            <p>Latest bookings for packages and products</p>
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Email</th>
                                            <th>Date</th>
                                            <th>Item</th>
                                            <th>Type</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% bookings.forEach((booking, index) => { %>
                                            <tr>

                                                <td>
                                                    <span ><%= booking.user.name %></span>
                                                </td>
                                                <td>
                                                    <span ><%= booking.user.email %></span>
                                                </td>
                                                <td><%= new Date(booking.bookingDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) %></td>
                                                <td><%= booking.itemName || 'N/A' %></td>
                                                <td>
                                                    <span class="badge badge-<%= booking.type === 'Package' ? 'success' : 'primary' %>"><%= booking.type %></span>
                                                </td>
                                                <td>
                                                    <span class="badge badge-<%= booking.status === 'approved' ? 'success' : booking.status === 'pending' ? 'warning' : 'danger' %>">
                                                        <%= booking.status %>
                                                    </span>
                                                </td>
                                            </tr>
                                        <% }) %>
                                        <% if (bookings.length === 0) { %>
                                            <tr>
                                                <td colspan="6" class="text-center">No bookings available</td>
                                            </tr>
                                        <% } %>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
             
                <div class="row">
                    <div class="col-lg-6">
                        <div class="dashboard-box">
                            <h4>Packages</h4>
                            <p>Recent travel packages</p>
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Image</th>
                                            <th>Title</th>
                                            <th>Price</th>
                                            <th>Discount</th>
                                            <th>Bookings</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% packages.forEach((pkg, index) => { %>
                                            <tr>
                                                <td>
                                                    <span class="list-img">
                                                        <img src="/uploads/gallery/<%= pkg.featuredImage  %>" alt="<%= pkg.title %>">
                                                    </span>
                                                </td>
                                                <td>
                                                    <a href="/package-preview/<%= pkg._id %>">
                                                        <span class="list-name"><%= pkg.title %></span>
                                                    </a>
                                                </td>
                                                <td>$<%= pkg.regularPrice.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) %></td>
                                                <td><%= pkg.discount %>%</td>
                                                <td>
                                                    <span class="badge badge-success"><%= pkg.bookingsCount %></span>
                                                </td>
                                            </tr>
                                        <% }) %>
                                        <% if (packages.length === 0) { %>
                                            <tr>
                                                <td colspan="5" class="text-center">No packages available</td>
                                            </tr>
                                        <% } %>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="dashboard-box">
                            <h4>Products</h4>
                            <p>Recent products</p>
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Image</th>
                                            <th>Name</th>
                                            <th>Price</th>
                                            <th>Discount</th>
                                            <th>Bookings</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% products.forEach((product, index) => { %>
                                            <tr>
                                                <td>
                                                    <span class="list-img">
                                                        <img src="/uploads/shopGallery/<%= product.featureImage%>" alt="<%= product.name %>">
                                                    </span>
                                                </td>
                                                <td>
                                                    <a href="/product-detail/<%= product._id %>">
                                                        <span class="list-name"><%= product.name %></span>
                                                    </a>
                                                </td>
                                                <td>$<%= product.price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) %></td>
                                                <td>$<%= product.discountPrice.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) %></td>
                                                <td>
                                                    <span class="badge badge-success"><%= product.bookingsCount %></span>
                                                </td>
                                            </tr>
                                        <% }) %>
                                        <% if (products.length === 0) { %>
                                            <tr>
                                                <td colspan="5" class="text-center">No products available</td>
                                            </tr>
                                        <% } %>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                
                <div class="row">
                    <div class="col-lg-6">
                        <div class="dashboard-box">
                            <h4>Contact Enquiries</h4>
                            <p>Latest contact enquiries</p>
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                       
                                            <th>Name</th>
                                            <th>Date</th>
                                            <th>Message</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% enquiries.forEach((enquiry, index) => { %>
                                            <tr>
                                    
                                                <td>
                                                    <span ><%= enquiry.name %></span>
                                                </td>
                                                <td><%= new Date(enquiry.createdAt).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) %></td>
                                                <td><%= enquiry.message.substring(0, 30) + (enquiry.message.length > 30 ? '...' : '') %></td>
                                                <td>
                                                    <span class="badge badge-<%= enquiry.enquiryStatus === 'active' ? 'success' : enquiry.enquiryStatus === 'pending' ? 'warning' : 'danger' %>">
                                                        <%= enquiry.enquiryStatus %>
                                                    </span>
                                                </td>
                                            </tr>
                                        <% }) %>
                                        <% if (enquiries.length === 0) { %>
                                            <tr>
                                                <td colspan="4" class="text-center">No enquiries available</td>
                                            </tr>
                                        <% } %>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="dashboard-box">
                            <h4>FAQs</h4>
                            <p>Recent frequently asked questions</p>
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Date</th>
                                            <th>Message</th>
                                            <th>Answer</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% faqs.forEach(faq => { %>
                                            <tr>
                                                <td><%= faq.name %></td>
                                                <td><%= new Date(faq.createdAt).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) %></td>

                                                <td><%= faq.message.substring(0, 30) + (faq.message.length > 30 ? '...' : '') %></td>
                                                <td><%= faq.answer.substring(0, 30) + (faq.answer.length > 30 ? '...' : '') %></td>
                                            </tr>
                                        <% }) %>
                                        <% if (faqs.length === 0) { %>
                                            <tr>
                                                <td colspan="4" class="text-center">No FAQs available</td>
                                            </tr>
                                        <% } %>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Content / End -->
            <!-- Copyrights -->
            <%- include('../partials/Footer')%>
        </div>
        <!-- Dashboard / End -->
    </div>
    <!-- end Container Wrapper -->
    <!-- *Scripts* -->
    <%- include('../../shared/partials/toaster') %>
    <script src="/admin/assets/js/jquery-3.2.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <script src="/admin/assets/js/bootstrap.min.js"></script>
    <script src="/admin/assets/js/jquery.slicknav.js"></script>
    <script src="/admin/assets/js/dashboard-custom.js"></script>
</body>
</html>