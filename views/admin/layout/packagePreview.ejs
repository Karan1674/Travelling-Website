<!DOCTYPE html>
<html lang="en">
<%- include('../partials/Header') %>
<head>
    <!-- Add Slick Slider CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick-theme.min.css">
    <style>
        /* Root Level */
        .single-tour-section {
            padding-bottom: 80px;
        }
        .single-tour-section .start-wrap {
            display: inline-block;
        }

        .single-page-section {
            padding-bottom: 70px;
        }

        /* Banner Section */
        .inner-banner-wrap {
            padding-bottom: 50px;
        }
        @media screen and (max-width: 575px) {
            .inner-banner-wrap {
                padding-bottom: 0;
            }
        }

        .inner-shape {
            background-image: url(/assets/images/slider-pattern.png);
            background-size: cover;
            background-repeat: no-repeat;
            height: 150px;
            width: 100%;
            margin-top: -100px;
            position: relative;
        }
        @media screen and (max-width: 991px) {
            .inner-shape {
                height: 105px;
            }
        }

        .inner-baner-container {
            background-size: cover;
            background-repeat: no-repeat;
            background-position: bottom center;
            padding: 190px 0 150px;
            text-align: center;
            position: relative;
        }
        .inner-baner-container:before {
            background-color: #151515;
            content: "";
            display: block;
            opacity: 0.65;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            position: absolute;
        }
        .inner-baner-container .inner-banner-content {
            position: relative;
            color: #ffffff;
        }
        .inner-baner-container .inner-title {
            color: #ffffff;
            line-height: 1.1;
        }
        @media screen and (max-width: 575px) {
            .inner-baner-container .inner-title {
                font-size: 30px;
            }
            .inner-baner-container .inner-banner-content p {
                font-size: 15px;
            }
        }

        /* Main Content */
        .single-tour-inner {
            margin-bottom: 50px;
        }
        .single-tour-inner h2 {
            margin-bottom: 35px;
            font-size: 1.8rem;
            font-weight: 600;
            color: #1a1a1a;
        }
        .single-tour-inner .package-meta {
            margin-top: 0;
            margin-left: 0;
            margin-right: 0;
        }
        @media screen and (min-width: 576px) {
            .single-tour-inner .package-meta ul li {
                font-size: 15px;
                padding: 0 30px;
            }
        }

        .feature-image {
            margin-bottom: 1.5rem;
        }
        .feature-image img {
            width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .single-feature-img img {
            margin-bottom: 30px;
        }

        .package-meta {
            background-color: #0791BE;
            margin-bottom: 25px;
            margin-left: 30px;
            margin-right: 30px;
            margin-top: -25px;
            padding: 15px 0;
            position: relative;
        }
        .package-meta ul {
            font-size: 0;
            margin: 0;
            padding: 0;
        }
        .package-meta ul li {
            color: #ffffff;
            display: inline-block;
            font-size: 13px;
            line-height: 1.1;
            padding: 0 12px;
            position: relative;
        }
        .package-meta ul li [class*=fa-] {
            margin-right: 4px;
        }
        .package-meta ul li:before {
            color: #BBBBBB;
            content: "|";
            line-height: 0.8;
            position: absolute;
            right: -3px;
            top: 0;
            font-size: 20px;
            top: -2px;
        }
        .package-meta ul li:first-child {
            padding-left: 0;
        }
        .package-meta ul li:last-child {
            padding-right: 0;
        }
        .package-meta ul li:last-child:before {
            display: none;
        }
        @media screen and (max-width: 575px) {
            .package-meta {
                margin-left: 10px;
                margin-right: 10px;
                margin-bottom: 20px;
            }
        }

        /* Tab Navigation */
        .tab-container {
            margin-top: 50px;
            margin-bottom: 50px;
        }
        @media screen and (max-width: 575px) {
            .tab-container .nav {
                display: block;
            }
            .tab-container .nav.nav-tabs a {
                border-width: 1px 1px 0 1px;
                border-style: solid;
                border-color: #dee2e6;
                padding: 15px 20px;
            }
            .tab-container .nav.nav-tabs a:hover,
            .tab-container .nav.nav-tabs a:focus,
            .tab-container .nav.nav-tabs a.active {
                background-color: #2C75BA;
                color: #ffffff;
            }
        }

        .tab-content {
            padding: 30px;
            border-width: 1px;
            border-style: solid;
            border-color: #ffffff;
        }
        .tab-content ul {
            margin: 30px 0 0;
            padding: 0;
        }
        .tab-content ul li {
            list-style: none;
            margin-bottom: 10px;
        }
        @media screen and (max-width: 575px) {
            .tab-content {
                padding: 20px;
            }
        }

        /* Description Tab */
        .overview-content p {
            font-size: 1rem;
            color: #333333;
            line-height: 1.6;
        }

        /* Program Tab */
        .itinerary-content h3 {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 1rem;
        }
        .itinerary-content p {
            font-size: 1rem;
            color: #333333;
            line-height: 1.6;
        }

        .itinerary-timeline-wrap {
            padding: 1rem 0;
        }
        .itinerary-timeline-wrap ul {
            list-style: none;
            padding-left: 2.5rem;
            position: relative;
            margin: 0;
        }
        .itinerary-timeline-wrap ul::before {
            content: '';
            position: absolute;
            left: 0.75rem;
            top: 0;
            bottom: 0;
            width: 6px;
            background: linear-gradient(to bottom, #007bff, #6c757d);
            border-radius: 3px;
        }
        .itinerary-timeline-wrap ul li {
            position: relative;
            margin-bottom: 2rem;
            padding-left: 1.75rem;
        }
        .itinerary-timeline-wrap ul li::before {
            content: '';
            position: absolute;
            left: -0.85rem;
            top: 0.6rem;
            width: 16px;
            height: 16px;
            background-color: #007bff;
            border-radius: 50%;
            border: 3px solid #ffffff;
        }

        .timeline-content {
            background: #ffffff;
            padding: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: box-shadow 0.3s ease;
        }
        .timeline-content:hover {
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }
        .day-count {
            font-size: 1rem;
            fontlığın: 600;
            color: #007bff;
            margin-bottom: 0.5rem;
        }
        .day-count span {
            font-size: 1.2rem;
        }
        .timeline-content h4 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1a1a1a;
            margin: 0 0 0.75rem;
        }
        .timeline-content p {
            font-size: 1rem;
            color: #333333;
            line-height: 1.6;
            margin: 0;
        }

        /* Itinerary Tab */
        .accordion-item {
            border: none !important;
            border-radius: 8px !important;
            margin-bottom: 1.2rem;
            background-color: #ffffff;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        .accordion-header {
            cursor: pointer;
            padding: 1.2rem 1.5rem;
            background-color: #f8f9fa;
            border-bottom: none;
            transition: background-color 0.3s ease;
        }
        .accordion-header:hover {
            background-color: #e9ecef;
        }
        .accordion-header h3 {
            margin: 0;
            font-size: 1.25rem;
            font-weight: 600;
            color: #1a1a1a;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .accordion-header i {
            font-size: 1.1rem;
            color: #007bff;
        }
        .accordion-header .toggle-icon {
            margin-left: auto;
            font-size: 1rem;
            color: #007bff;
            transition: transform 0.3s ease;
        }
        .accordion-header[aria-expanded="true"] .toggle-icon {
            transform: rotate(180deg);
        }
        .accordion-body {
            padding: 1.5rem;
            background-color: #ffffff;
            font-size: 1rem;
            color: #333333;
            line-height: 1.6;
        }

        .timeline {
            position: relative;
            padding-left: 2.5rem;
            margin: 0;
        }
        .timeline::before {
            content: '';
            position: absolute;
            left: 0.75rem;
            top: 0;
            bottom: 0;
            width: 6px;
            background: linear-gradient(to bottom, #007bff, #6c757d);
            border-radius: 3px;
        }
        .timeline-item {
            position: relative;
            margin-bottom: 2rem;
            padding-left: 1.75rem;
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -0.85rem;
            top: 0.6rem;
            width: 16px;
            height: 16px;
            background-color: #007bff;
            border-radius: 50%;
            border: 3px solid #ffffff;
        }

        .activity-card {
            background: #ffffff;
            padding: 1rem;
        }
        .activity-card h5 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1a1a1a;
            margin: 0 0 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .activity-subtitle {
            font-size: 0.95rem;
            color: #555555;
            margin: 0 0 0.75rem;
            font-style: italic;
        }
        .activity-time {
            font-size: 0.9rem;
            color: #007bff;
            margin: 0 0 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .activity-type {
            display: inline-flex;
            align-items: center;
            padding: 0.4rem 0.8rem;
            font-size: 0.85rem;
            color: #ffffff;
            background-color: #007bff;
            border-radius: 12px;
            gap: 0.3rem;
        }

        /* Additional Info Tab */
        .additional-info-content h3 {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1a1a1a;
        }
        .info-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .info-list li {
            font-size: 1rem;
            color: #333333;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .info-list li i {
            color: #007bff;
        }
        .quote-block {
            font-style: italic;
            color: #555555;
            border-left: 4px solid #007bff;
            padding-left: 1rem;
            margin: 1rem 0;
        }

        /* Review Tab */
        .summary-review {
            background-color: #f9f9f9;
            display: flex;
            align-items: center;
            padding: 20px;
            justify-content: center;
        }
        .summary-review .review-score span {
            background-color: #fff;
            font-family: "Raleway", sans-serif;
            border-radius: 50%;
            width: 90px;
            display: block;
            height: 90px;
            margin: auto;
            font-weight: 700;
            font-size: 40px;
            line-height: 88px;
            text-align: center;
        }
        .summary-review .review-score-content {
            margin-left: 20px;
        }
        .summary-review .review-score-content p:last-child {
            margin-bottom: 0;
        }
        .summary-review .review-score-content span {
            color: #999;
            font-size: 18px;
            font-weight: 300;
        }
        @media screen and (max-width: 575px) {
            .summary-review {
                flex-wrap: wrap;
                width: 100%;
                text-align: center;
            }
            .summary-review .review-score {
                margin-bottom: 20px;
            }
        }

        .comment-area {
            margin-top: 60px;
        }
        .comment-area .comment-title {
            margin-bottom: 25px;
        }
        .comment-area ol {
            margin: 0;
            padding: 0;
        }
        .comment-area ol ol {
            margin-left: 30px;
        }
        .comment-area ol li {
            list-style: none;
            margin-bottom: 30px;
        }
        .comment-area ol li:before,
        .comment-area ol li:after {
            content: "";
            display: block;
            clear: both;
        }
        .comment-area .comment-thumb {
            width: 45px;
            border-radius: 100%;
            overflow: hidden;
            float: left;
        }
        .comment-area .comment-content {
            border: 1px solid #e6e6e6;
            width: calc(100% - 65px);
            float: right;
            padding: 20px;
        }
        .comment-area .comment-content .comment-header {
            margin-bottom: 10px;
        }
        .comment-area .comment-content p {
            margin-bottom: 15px;
        }
        .comment-area .comment-content h5 {
            display: inline-block;
            margin-bottom: 0;
        }
        .comment-area .comment-content .post-on {
            font-size: 13px;
            margin-left: 10px;
        }
        .comment-area .comment-content .reply {
            background-color: #F56960;
            font-size: 14px;
            color: #ffffff;
            padding: 5px 12px 6px;
            display: inline-block;
            line-height: 1.2;
            transition: all 0.4s;
        }
        .comment-area .comment-content .reply i {
            margin-right: 4px;
            font-size: 12px;
        }
        .comment-area .comment-content .reply:hover {
            background-color: #2C75BA;
        }
        @media screen and (max-width: 575px) {
            .comment-area .comment-thumb {
                width: 25px;
            }
            .comment-area .comment-content {
                width: calc(100% - 35px);
            }
        }

        .comment-form-wrap {
            padding-top: 30px;
            margin-top: 2rem;
        }
        .comment-form-wrap .rate-wrap {
            padding: 0 15px;
            margin-bottom: 15px;
        }
        .comment-form-wrap label {
            display: block;
        }
        .comment-form-wrap input:not([type=submit]) {
            background-color: #F8F8F8;
            width: 100%;
            border: none;
            padding: 0.75rem;
            border-radius: 4px;
            font-size: 1rem;
        }
        .comment-form-wrap textarea {
            background-color: #F8F8F8;
            border: none;
            width: 100%;
            padding: 0.75rem;
            border-radius: 4px;
            font-size: 1rem;
            resize: vertical;
        }
        .comment-form-wrap input[type=submit] {
            margin-top: 20px;
            background-color: #007bff;
            color: #ffffff;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .comment-form-wrap input[type=submit]:hover {
            background-color: #0056b3;
        }

        .rate-wrap {
            margin-bottom: 1rem;
        }
        .package-rate {
            display: flex;
            flex-direction: row;
            align-items: flex-start;
            cursor: pointer;
        }
        .package-rate input[type="radio"] {
            display: none;
        }
        .package-rate label {
            font-size: 1.2rem;
            color: #ccc;
            cursor: pointer;
            margin: 2px 0;
        }
        .package-rate label.filled {
            color: #f5c518;
        }
        .review-message {
            display: none;
            margin-top: 1rem;
            padding: 0.75rem;
            border-radius: 4px;
        }
        .review-message.success {
            background-color: #ffffff;
            color: #155724;
        }
        .review-message.error {
            background-color: #fff;
            color: #721c24;
        }

        /* Map Tab */
        .map-area iframe {
            width: 100%;
            border: 0;
            border-radius: 8px;
            height: 450px;
        }

        /* Gallery */
        .single-tour-gallery h3 {
            margin-bottom: 25px;
            text-transform: uppercase;
        }
        .single-tour-inner .single-tour-item {
            padding: 0 9px;
        }
        .single-tour-inner .slick-slider {
            overflow: hidden;
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE and Edge */
        }
        .single-tour-inner .slick-slider::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }
        .single-tour-inner .slick-slider .slick-dots {
            position: static;
            margin-top: 10px;
            text-align: center;
        }
        .single-tour-inner .slick-slider .slick-dots li {
            display: inline-block;
            margin: 0 5px;
        }
        .single-tour-inner .slick-slider .slick-dots li button {
            height: 10px;
            width: 10px;
            padding: 0;
            border-radius: 50%;
            background-color: #ccc;
            border: none;
            text-indent: -9999px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .single-tour-inner .slick-slider .slick-dots li.slick-active button {
            background-color: #007bff;
        }
        .single-tour-inner .slick-list {
            margin: 0 -9px;
        }
        .single-tour-slider {
            /* Removed flexbox properties */
        }
        .single-tour-item {
            /* Removed flex: 0 0 50% and scroll-snap-align */
        }
        .single-tour-item .feature-image img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 8px;
        }

        /* Bookings Table */
        .bookings-table-wrap {
            margin-top: 2rem;
        }
        .bookings-table-wrap h3 {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 1rem;
        }
        .table-responsive {
            overflow-x: auto;
        }
        .table {
            width: 100%;
            border-collapse: collapse;
            background-color: #ffffff;
        }
        .table th,
        .table td {
            padding: 0.75rem;
            border: 1px solid #ddd;
            text-align: left;
        }
        .table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #1a1a1a;
        }
        .table td {
            color: #333333;
        }
        .table .badge {
            padding: 0.4rem 0.8rem;
            font-size: 0.85rem;
            border-radius: 4px;
            cursor: pointer;
        }
        .table .badge-info {
            background-color: #17a2b8;
        }
        .table .badge-success {
            background-color: #28a745;
        }
        .table .badge-primary {
            background-color: #007bff;
        }
        .table .badge-danger {
            background-color: #dc3545;
        }
        .table .badge:hover {
            opacity: 0.9;
        }

        /* Sidebar */
        .sidebar .package-price {
            background-color: #F56960;
            padding: 20px;
            text-align: center;
            margin-bottom: 50px;
        }
        .sidebar .package-price .price {
            color: #ffffff;
            font-family: "Open Sans", sans-serif;
        }
        .sidebar .package-price .price span {
            font-size: 30px;
            font-weight: 900;
            line-height: 1.1;
        }
        .sidebar .package-price .rating-start:before {
            color: #ffffff;
        }
        .sidebar .package-price p {
            font-size: 0.9rem;
            color: #ffffff;
        }
        .sidebar .map-area {
            margin-bottom: 50px;
        }
        .sidebar .information-content {
            background-color: #f8f8f8;
            padding: 50px 30px;
            margin-bottom: 50px;
        }
        .sidebar .information-content .button-primary {
            margin-top: 20px;
        }
        .sidebar .information-content h5 {
            color: #F56960;
            font-size: 15px;
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: 22px;
            display: inline-block;
            text-transform: uppercase;
            padding-left: 60px;
            position: relative;
        }
        .sidebar .information-content h5:before {
            background-color: #F56960;
            content: "";
            height: 2px;
            width: 50px;
            margin-right: 10px;
            position: absolute;
            left: 0;
            top: 50%;
        }
        .sidebar .information-content h3 {
            text-transform: uppercase;
            font-size: 1.25rem;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 0.75rem;
        }
        .sidebar .information-content p {
            font-size: 1rem;
            color: #333333;
            line-height: 1.6;
        }

        /* Quote Section */
        .quote-wrap {
            text-align: center;
            padding: 1.5rem;
        }
        .quote-wrap blockquote {
            font-size: 1.2rem;
            font-style: italic;
            color: #333333;
            margin: 0 0 1.5rem;
            line-height: 1.6;
        }
        .quote-wrap cite {
            font-size: 0.9rem;
            color: #555555;
            font-style: normal;
            display: block;
            margin-bottom: 1.5rem;
        }
        .quote-wrap .button-group {
            display: flex;
            justify-content: center;
            gap: 1rem;
        }
        .quote-wrap .button-primary {
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .quote-wrap .button-primary.book-now {
            background-color: #007bff;
            color: #ffffff;
        }
        .quote-wrap .button-primary.book-now:hover {
            background-color: #0056b3;
        }
        .quote-wrap .button-primary.add-to-cart {
            background-color: #28a745;
            color: #ffffff;
        }
        .quote-wrap .button-primary.add-to-cart:hover {
            background-color: #218838;
        }

        /* Miscellaneous */
        .rating-start {
            font-size: 1rem;
            color: #ccc;
            display: inline-flex;
        }
        .rating-start i {
            margin: 0 2px;
        }
        .rating-start .filled {
            color: #f5c518;
        }
        .rating-data .filled {
            color: #ffffff;
        }
        .reply {
            font-size: 0.9rem;
            color: #007bff;
            text-decoration: none;
        }
        .reply:hover {
            text-decoration: underline;
        }
        .button-primary {
            background-color: #007bff;
            color: #ffffff;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            text-decoration: none;
            transition: background-color 0.3s ease;
            display: inline-block;
        }
        .button-primary:hover {
            background-color: #0056b3;
        }
        .submit-btn button.button-primary {
            margin-left: 10px;
            background-color: #007bff;
            color: white;
        }
    </style>
</head>
<body>
    <div id="container-wrapper">
        <div id="dashboard" class="dashboard-container">
            <%- include('../partials/Navbar') %>
            <%- include('../partials/Sidebar') %>
            <main id="content" class="db-info-wrap db-package-wrap">
                <section class="inner-banner-wrap">
                    <div class="inner-baner-container" style="background-image: url(/assets/images/inner-banner.jpg);">
                        <div class="container">
                            <div class="inner-banner-content">
                                <h1 class="inner-title">
                                    <%= package ? package.title : 'Package Not Found' %> - Preview
                                </h1>
                            </div>
                        </div>
                    </div>
                    <div class="inner-shape"></div>
                </section>
                <div class="single-tour-section">
                    <div class="container">
                        <% if (package) { %>
                        <div class="row">
                            <div class="col-lg-8">
                                <div class="single-tour-inner">
                                    <h2><%= package.title || 'Untitled Package' %></h2>
                                    <figure class="feature-image">
                                        <img src="<%= package.featuredImage ? '/Uploads/gallery/' + package.featuredImage : '/assets/images/default.jpg' %>"
                                             alt="<%= package.title || 'Package Image' %>">
                                        <div class="package-meta text-center">
                                            <ul>
                                                <li><i class="far fa-clock"></i>
                                                    <%= package.tripDuration?.days || 0 %> days / <%= package.tripDuration?.nights || 0 %> night
                                                </li>
                                                <li><i class="fas fa-user-friends"></i> People: <%= package.groupSize || 'N/A' %>
                                                </li>
                                                <li><i class="fas fa-map-marked-alt"></i>
                                                    <%= package.destinationCountry || 'N/A' %>
                                                </li>
                                            </ul>
                                        </div>
                                    </figure>
                                    <div class="tab-container">
                                        <ul class="nav nav-tabs" id="myTab" role="tablist">
                                            <li class="nav-item">
                                                <a class="nav-link active" id="overview-tab" data-bs-toggle="tab"
                                                   href="#overview" role="tab" aria-controls="overview"
                                                   aria-selected="true">DESCRIPTION</a>
                                            </li>
                                            <li class="nav-item">
                                                <a class="nav-link" id="program-tab" data-bs-toggle="tab"
                                                   href="#program" role="tab" aria-controls="program"
                                                   aria-selected="false">PROGRAM</a>
                                            </li>
                                            <li class="nav-item">
                                                <a class="nav-link" id="itinerary-overview-tab" data-bs-toggle="tab"
                                                   href="#itinerary-overview" role="tab" aria-controls="itinerary-overview"
                                                   aria-selected="false">ITINERARY</a>
                                            </li>
                                            <li class="nav-item">
                                                <a class="nav-link" id="additional-info-tab" data-bs-toggle="tab"
                                                   href="#additional-info" role="tab" aria-controls="additional-info"
                                                   aria-selected="false">ADDITIONAL INFO</a>
                                            </li>
                                            <li class="nav-item">
                                                <a class="nav-link" id="review-tab" data-bs-toggle="tab"
                                                   href="#review" role="tab" aria-controls="review"
                                                   aria-selected="false">REVIEW</a>
                                            </li>
                                            <li class="nav-item">
                                                <a class="nav-link" id="map-tab" data-bs-toggle="tab"
                                                   href="#map" role="tab" aria-controls="map"
                                                   aria-selected="false">MAP</a>
                                            </li>
                                        </ul>
                                        <div class="tab-content" id="myTabContent">
                                            <!-- Description Tab -->
                                            <div class="tab-pane fade show active" id="overview"
                                                 role="tabpanel" aria-labelledby="overview-tab">
                                                <div class="overview-content">
                                                    <p><%= package.description || 'No description available.' %></p>
                                                </div>
                                            </div>
                                            <!-- Program Tab (Itinerary Overview) -->
                                            <div class="tab-pane fade" id="program" role="tabpanel"
                                                 aria-labelledby="program-tab">
                                                <div class="itinerary-content">
                                                    <h3>Itinerary Overview <span>( <%= package.tripDuration?.days || 4 %> days )</span></h3>
                                                    <p><%= package.itineraryDescription || 'No itinerary description available.' %></p>
                                                </div>
                                                <div class="itinerary-timeline-wrap">
                                                    <ul>
                                                        <li>
                                                            <div class="timeline-content">
                                                                <div class="day-count">Day <span>1</span></div>
                                                                <h4>Ancient Rome Visit</h4>
                                                                <p>Nostra semper ultricies eu leo eros orci porta provident, fugit? Pariatur interdum assumenda, qui aliquip ipsa! Dictum natus potenti pretium.</p>
                                                            </div>
                                                        </li>
                                                        <li>
                                                            <div class="timeline-content">
                                                                <div class="day-count">Day <span>2</span></div>
                                                                <h4>Classic Rome Sightseeing</h4>
                                                                <p>Nostra semper ultricies eu leo eros orci porta provident, fugit? Pariatur interdum assumenda, qui aliquip ipsa! Dictum natus potenti pretium.</p>
                                                            </div>
                                                        </li>
                                                        <li>
                                                            <div class="timeline-content">
                                                                <div class="day-count">Day <span>3</span></div>
                                                                <h4>Vatican City Visit</h4>
                                                                <p>Nostra semper ultricies eu leo eros orci porta provident, fugit? Pariatur interdum assumenda, qui aliquip ipsa! Dictum natus potenti pretium.</p>
                                                            </div>
                                                        </li>
                                                        <li>
                                                            <div class="timeline-content">
                                                                <div class="day-count">Day <span>4</span></div>
                                                                <h4>Italian Food Tour</h4>
                                                                <p>Nostra semper ultricies eu leo eros orci porta provident, fugit? Pariatur interdum assumenda, qui aliquip ipsa! Dictum natus potenti pretium.</p>
                                                            </div>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <!-- Detailed Itinerary Tab -->
                                            <div class="tab-pane fade" id="itinerary-overview" role="tabpanel"
                                                 aria-labelledby="itinerary-overview-tab">
                                                <div class="itinerary-content">
                                                    <h3 class="mb-3">Detailed Itinerary <span class="text-muted fs-5">(<%= package.tripDuration?.days || 0 %> days)</span></h3>
                                                    <p class="text-muted mb-4"><%= package.itineraryDescription || 'Explore the highlights of this amazing journey.' %></p>
                                                </div>
                                                <div class="itinerary-timeline-wrap w-100">
                                                    <% if (package.itineraryDays && package.itineraryDays.length > 0) { %>
                                                    <div class="accordion accordion-flush" id="itineraryAccordion">
                                                        <% package.itineraryDays.forEach((day, index) => { %>
                                                        <div class="accordion-item">
                                                            <div class="accordion-header" id="dayHeading<%= index %>"
                                                                 data-bs-toggle="collapse"
                                                                 data-bs-target="#dayCollapse<%= index %>"
                                                                 aria-expanded="<%= index === 0 ? 'true' : 'false' %>"
                                                                 aria-controls="dayCollapse<%= index %>">
                                                                <h3><i class="fas fa-calendar-day"></i> Day <%= day.day || (index + 1) %>
                                                                    <i class="fas fa-chevron-down toggle-icon"></i>
                                                                </h3>
                                                            </div>
                                                            <div id="dayCollapse<%= index %>"
                                                                 class="accordion-collapse collapse <%= index === 0 ? 'show' : '' %>"
                                                                 aria-labelledby="dayHeading<%= index %>"
                                                                 data-bs-parent="#itineraryAccordion">
                                                                <div class="accordion-body">
                                                                    <% if (day.activities && day.activities.length > 0) { %>
                                                                    <div class="timeline">
                                                                        <% day.activities.forEach(activity => { %>
                                                                        <div class="timeline-item">
                                                                            <div class="activity-card">
                                                                                <h5><i class="fas fa-map-pin"></i>
                                                                                    <%= activity.title || 'Activity' %>
                                                                                </h5>
                                                                                <p class="activity-subtitle">
                                                                                    <%= activity.sub_title || 'No subtitle' %>
                                                                                </p>
                                                                                <p class="activity-time">
                                                                                    <i class="far fa-clock"></i>
                                                                                    <%= activity.start_time || 'N/A' %> -
                                                                                    <%= activity.end_time || 'N/A' %>
                                                                                </p>
                                                                                <% if (activity.type) { %>
                                                                                <span class="activity-type"><i
                                                                                        class="fas fa-tag"></i>
                                                                                    <%= activity.type %>
                                                                                </span>
                                                                                <% } %>
                                                                            </div>
                                                                        </div>
                                                                        <% }) %>
                                                                    </div>
                                                                    <% } else { %>
                                                                    <p class="text-muted">No activities scheduled for this day.</p>
                                                                    <% } %>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <% }) %>
                                                    </div>
                                                    <% } else { %>
                                                    <p class="text-muted">No itinerary details available.</p>
                                                    <% } %>
                                                </div>
                                            </div>
                                            <!-- Additional Info Tab -->
                                            <div class="tab-pane fade" id="additional-info" role="tabpanel"
                                                 aria-labelledby="additional-info-tab">
                                                <div class="additional-info-content">
                                                    <h3 class="mb-4">Additional Information</h3>
                                                    <div class="accordion accordion-flush" id="additionalInfoAccordion">
                                                        <% if (package.inclusions && package.inclusions.length > 0) { %>
                                                        <div class="accordion-item">
                                                            <div class="accordion-header" id="inclusionsHeading"
                                                                 data-bs-toggle="collapse" data-bs-target="#inclusionsCollapse"
                                                                 aria-expanded="true" aria-controls="inclusionsCollapse">
                                                                <h3><i class="fas fa-check-circle"></i> Inclusions <i
                                                                        class="fas fa-chevron-down toggle-icon"></i></h3>
                                                            </div>
                                                            <div id="inclusionsCollapse"
                                                                 class="accordion-collapse collapse show"
                                                                 aria-labelledby="inclusionsHeading"
                                                                 data-bs-parent="#additionalInfoAccordion">
                                                                <div class="accordion-body">
                                                                    <ul class="info-list">
                                                                        <% package.inclusions.forEach(item => { %>
                                                                        <li><i class="fas fa-check"></i>
                                                                            <%= item %>
                                                                        </li>
                                                                        <% }) %>
                                                                    </ul>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <% } %>
                                                        <% if (package.exclusions && package.exclusions.length > 0) { %>
                                                        <div class="accordion-item">
                                                            <div class="accordion-header" id="exclusionsHeading"
                                                                 data-bs-toggle="collapse" data-bs-target="#exclusionsCollapse"
                                                                 aria-expanded="false" aria-controls="exclusionsCollapse">
                                                                <h3><i class="fas fa-times-circle"></i> Exclusions <i
                                                                        class="fas fa-chevron-down toggle-icon"></i></h3>
                                                            </div>
                                                            <div id="exclusionsCollapse"
                                                                 class="accordion-collapse collapse"
                                                                 aria-labelledby="exclusionsHeading"
                                                                 data-bs-parent="#additionalInfoAccordion">
                                                                <div class="accordion-body">
                                                                    <ul class="info-list">
                                                                        <% package.exclusions.forEach(item => { %>
                                                                        <li><i class="fas fa-times"></i>
                                                                            <%= item %>
                                                                        </li>
                                                                        <% }) %>
                                                                    </ul>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <% } %>
                                                        <% if (package.highlights && package.highlights.length > 0) { %>
                                                        <div class="accordion-item">
                                                            <div class="accordion-header" id="highlightsHeading"
                                                                 data-bs-toggle="collapse" data-bs-target="#highlightsCollapse"
                                                                 aria-expanded="false" aria-controls="highlightsCollapse">
                                                                <h3><i class="fas fa-star"></i> Highlights <i
                                                                        class="fas fa-chevron-down toggle-icon"></i></h3>
                                                            </div>
                                                            <div id="highlightsCollapse"
                                                                 class="accordion-collapse collapse"
                                                                 aria-labelledby="highlightsHeading"
                                                                 data-bs-parent="#additionalInfoAccordion">
                                                                <div class="accordion-body">
                                                                    <ul class="info-list">
                                                                        <% package.highlights.forEach(highlight => { %>
                                                                        <li><i class="fas fa-star"></i>
                                                                            <%= highlight %>
                                                                        </li>
                                                                        <% }) %>
                                                                    </ul>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <% } %>
                                                        <div class="accordion-item">
                                                            <div class="accordion-header" id="detailsHeading"
                                                                 data-bs-toggle="collapse" data-bs-target="#detailsCollapse"
                                                                 aria-expanded="false" aria-controls="detailsCollapse">
                                                                <h3><i class="fas fa-info-circle"></i> Details <i
                                                                        class="fas fa-chevron-down toggle-icon"></i></h3>
                                                            </div>
                                                            <div id="detailsCollapse" class="accordion-collapse collapse"
                                                                 aria-labelledby="detailsHeading"
                                                                 data-bs-parent="#additionalInfoAccordion">
                                                                <div class="accordion-body">
                                                                    <ul class="info-list">
                                                                        <li><i class="fas fa-info-circle"></i>
                                                                            <strong>Type:</strong>
                                                                            <%= package.packageType || 'N/A' %>
                                                                        </li>
                                                                        <li><i class="fas fa-info-circle"></i>
                                                                            <strong>Category:</strong>
                                                                            <%= package.category || 'N/A' %>
                                                                        </li>
                                                                        <li><i class="fas fa-info-circle"></i>
                                                                            <strong>Difficulty Level:</strong>
                                                                            <%= package.difficultyLevel || 'N/A' %>
                                                                        </li>
                                                                        <li><i class="fas fa-info-circle"></i>
                                                                            <strong>Group Size:</strong>
                                                                            <%= package.groupSize || 'N/A' %>
                                                                        </li>
                                                                        <li><i class="fas fa-info-circle"></i>
                                                                            <strong>Destination:</strong>
                                                                            <%= package.destinationAddress ? `${package.destinationAddress}, ${package.destinationCountry}` : package.destinationCountry || 'N/A' %>
                                                                        </li>
                                                                    </ul>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <% if (package.multipleDepartures && package.multipleDepartures.length > 0) { %>
                                                        <div class="accordion-item">
                                                            <div class="accordion-header" id="departuresHeading"
                                                                 data-bs-toggle="collapse" data-bs-target="#departuresCollapse"
                                                                 aria-expanded="false" aria-controls="departuresCollapse">
                                                                <h3><i class="fas fa-calendar-alt"></i> Departure Dates And
                                                                    Locations <i
                                                                        class="fas fa-chevron-down toggle-icon"></i></h3>
                                                            </div>
                                                            <div id="departuresCollapse"
                                                                 class="accordion-collapse collapse"
                                                                 aria-labelledby="departuresHeading"
                                                                 data-bs-parent="#additionalInfoAccordion">
                                                                <div class="accordion-body">
                                                                    <ul class="info-list">
                                                                        <% package.multipleDepartures.forEach(departure => { %>
                                                                        <li><i class="fas fa-calendar-check"></i>
                                                                            <%= departure.dateTime.toDateString() %> - <%= departure.location %>
                                                                        </li>
                                                                        <% }) %>
                                                                    </ul>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <% } %>
                                                        <% if (package.quote) { %>
                                                        <div class="accordion-item">
                                                            <div class="accordion-header" id="quoteHeading"
                                                                 data-bs-toggle="collapse" data-bs-target="#quoteCollapse"
                                                                 aria-expanded="false" aria-controls="quoteCollapse">
                                                                <h3><i class="fas fa-quote-left"></i> Quote <i
                                                                        class="fas fa-chevron-down toggle-icon"></i></h3>
                                                            </div>
                                                            <div id="quoteCollapse" class="accordion-collapse collapse"
                                                                 aria-labelledby="quoteHeading"
                                                                 data-bs-parent="#additionalInfoAccordion">
                                                                <div class="accordion-body">
                                                                    <blockquote class="quote-block">
                                                                        <p>"<%= package.quote %>"</p>
                                                                    </blockquote>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <% } %>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- Review Tab -->
                                            <div class="tab-pane fade" id="review" role="tabpanel"
                                                 aria-labelledby="review-tab">
                                                <div class="summary-review">
                                                    <div class="review-score">
                                                        <span id="average-rating">
                                                            <%= reviews && reviews.length > 0 ? (reviews.reduce((sum, review) => sum + review.rating, 0) / reviews.length).toFixed(1) : '0' %>
                                                        </span>
                                                    </div>
                                                    <div class="review-score-content">
                                                        <h3>
                                                            <%= reviews && reviews.length > 0 ? (reviews.reduce((sum, review) => sum + review.rating, 0) / reviews.length >= 4 ? 'Excellent' : reviews.reduce((sum, review) => sum + review.rating, 0) / reviews.length >= 3 ? 'Good' : 'Average') : 'No Reviews' %>
                                                            <span id="review-count">( Based on <%= reviews ? reviews.length : 0 %> reviews )</span>
                                                        </h3>
                                                        <p>Tincidunt iaculis pede mus lobortis hendrerit eveniet impedit aenean mauris qui, pharetra rem doloremque laboris euismod deserunt non, cupiditate, vestibulum.</p>
                                                    </div>
                                                </div>
                                                <div class="comment-area">
                                                    <h3 class="comment-title" id="review-title">
                                                        <%= reviews ? reviews.length : 0 %> Reviews
                                                    </h3>
                                                    <div class="comment-area-inner">
                                                        <ol id="review-list"></ol>
                                                    </div>
                                                    <div class="comment-form-wrap">
                                                        <h3 class="comment-title">Leave a Review</h3>
                                                        <form class="comment-form" id="review-form">
                                                            <input type="hidden" name="packageId" value="<%= package._id %>">
                                                            <div class="full-width rate-wrap">
                                                                <label>Your rating</label>
                                                                <div class="package-rate"
                                                                     aria-label="Select a rating from 1 to 5 stars">
                                                                    <input type="radio" id="star1" name="rating" value="1"
                                                                           required>
                                                                    <label for="star1" class="fas fa-star"></label>
                                                                    <input type="radio" id="star2" name="rating" value="2">
                                                                    <label for="star2" class="fas fa-star"></label>
                                                                    <input type="radio" id="star3" name="rating" value="3">
                                                                    <label for="star3" class="fas fa-star"></label>
                                                                    <input type="radio" id="star4" name="rating" value="4">
                                                                    <label for="star4" class="fas fa-star"></label>
                                                                    <input type="radio" id="star5" name="rating" value="5">
                                                                    <label for="star5" class="fas fa-star"></label>
                                                                </div>
                                                            </div>
                                                            <p>
                                                                <input type="text" name="name" placeholder="Name"
                                                                       value="<%= user ? user.firstName + ' ' + user.lastName : '' %>"
                                                                       required>
                                                            </p>
                                                            <p>
                                                                <input type="email" name="email" placeholder="Email"
                                                                       value="<%= user ? user.email : '' %>" required>
                                                            </p>
                                                            <p>
                                                                <input type="text" name="subject" placeholder="Subject"
                                                                       required>
                                                            </p>
                                                            <p>
                                                                <textarea rows="6" name="comment" placeholder="Your review"
                                                                          required></textarea>
                                                            </p>
                                                            <p>
                                                                <input type="submit" value="Submit">
                                                            </p>
                                                            <p class="review-message" id="review-message"></p>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- Map Tab -->
                                            <div class="tab-pane fade" id="map" role="tabpanel" aria-labelledby="map-tab">
                                                <div class="map-area">
                                                    <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2000!2d<%= package.longitude || 0 %>!3d<%= package.latitude || 0 %>!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2z<%= package.latitude || 0 %>%2C<%= package.longitude || 0 %>!5e0!3m2!1sen!2snp!4v1579777829477!5m2!1sen!2snp"
                                                            height="450" allowfullscreen="" loading="lazy"></iframe>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Gallery -->
                                    <% if (package.gallery && package.gallery.length > 0) { %>
                                        <div class="single-tour-gallery">
                                            <h3>GALLERY / PHOTOS</h3>
                                            <div class="single-tour-slider">
                                                <% package.gallery.forEach(image => { %>
                                                <div class="single-tour-item">
                                                    <figure class="feature-image">
                                                        <img src="<%= image ? '/Uploads/gallery/' + image : '/assets/images/default.jpg' %>"
                                                             alt="<%= package.title || 'Gallery Image' %>">
                                                    </figure>
                                                </div>
                                                <% }) %>
                                            </div>
                                        </div>
                                        <% } %>
                              
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="sidebar">
                                    <div class="package-price">
                                        <h5 class="price">
                                            <span>$<%= package.salePrice || package.regularPrice || 'N/A' %></span> / per person
                                        </h5>
                                        <% if (package.discount && package.salePrice < package.regularPrice) { %>
                                        <p class="text-muted">Regular Price: <span
                                                class="text-decoration-line-through">$<%= package.regularPrice %></span> (<%=
                                                package.discount %>% OFF)</p>
                                        <% } %>
                                        <div class="start-wrap">
                                            <div class="rating-start rating-data"
                                                 title="Rated <%= reviews && reviews.length > 0 ? (reviews.reduce((sum, review) => sum + review.rating, 0) / reviews.length).toFixed(1) : 0 %> out of 5">
                                                <% for (let i = 1; i <= 5; i++) { %>
                                                <i class="fas fa-star <%= i <= (reviews && reviews.length > 0 ? Math.round(reviews.reduce((sum, review) => sum + review.rating, 0) / reviews.length) : 0) ? 'filled' : '' %>"></i>
                                                <% } %>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="widget-bg information-content text-center">
                                        <h5>TRAVEL TIPS</h5>
                                        <h3>NEED TRAVEL RELATED TIPS & INFORMATION</h3>
                                        <p>'Mollit voluptatem perspiciatis convallis elementum corporis quo veritatis aliquid
                                            blandit.'</p>
                                    </div>
                                </div>
                                
                            </div>
                                  <!-- Bookings Table -->
                                  <div class="col-lg-12 bookings-table-wrap">
                                    <h3>Bookings for <%= package.title %></h3>
                                    <div class="table-responsive">
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th>Booking ID</th>
                                                    <th>Name</th>
                                                    <th>Email</th>
                                                    <th>Total</th>
                                                    <th>Status</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <% if (bookings && bookings.length > 0) { %>
                                                    <% bookings.forEach(booking => { %>
                                                        <tr>
                                                            <td><%= booking._id %></td>
                                                            <td>
                                                                <%= booking.userId ? `${booking.userId.firstName} ${booking.userId.lastName}` : 'N/A' %>
                                                            </td>
                                                            <td>
                                                                <%= booking.userId ? booking.userId.email : 'N/A' %>
                                                            </td>
                                                            <td>$<%= booking.total ? booking.total.toFixed(2) : '0.00' %></td>
                                                            <td>
                                                                <span class="badge badge-<%= booking.status === 'confirmed' ? 'success' : booking.status === 'pending' ? 'primary' : 'danger' %>">
                                                                    <%= booking.status %>
                                                                </span>
                                                            </td>
                                                            <td>
                                                                <a href="/admin/bookings/edit/<%= booking._id %>" class="badge badge-info" title="View Booking"><i class="far fa-eye"></i></a>
                                                                <!-- <a href="/admin/bookings/edit/<%= booking._id %>" class="badge badge-success" title="Edit Booking"><i class="far fa-edit"></i></a> -->
                                                            </td>
                                                        </tr>
                                                    <% }) %>
                                                <% } else { %>
                                                    <tr>
                                                        <td colspan="6" style="text-align: center;">No bookings found for this package.</td>
                                                    </tr>
                                                <% } %>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                        </div>
                        <% } else { %>
                        <div class="row">
                            <div class="col-12 text-center">
                                <h3>Package Not Found</h3>
                                <p>The requested package is not available or is not active. Please explore other packages.</p>
                                <a href="/db-all-packages" class="button-primary">View All Packages</a>
                            </div>
                        </div>
                        <% } %>
                    </div>
                </div>
            </main>
            <%- include('../partials/Footer') %>
        </div>
    </div>
    <%- include('../partials/Script') %>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Add jQuery and Slick Slider JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.js"></script>
    <script>
        // Initialize Slick Slider
        $(document).ready(function(){
            $('.single-tour-slider').slick({
                slidesToShow: 2,
                slidesToScroll: 2,
                dots: true,
                arrows: false,
                draggable: true,
                infinite: true,
                speed: 300,
                cssEase: 'linear',
                responsive: [
                    {
                        breakpoint: 576,
                        settings: {
                            slidesToShow: 1,
                            slidesToScroll: 1
                        }
                    }
                ]
            });
        });

        // Store initial reviews from package data
        let reviews = <%- JSON.stringify(reviews || []) %>;

        // Function to render reviews
        function renderReviews() {
            const reviewList = document.getElementById('review-list');
            const reviewTitle = document.getElementById('review-title');
            const averageRating = document.getElementById('average-rating');
            const reviewCount = document.getElementById('review-count');

            // Update review count and average rating
            const reviewCountValue = reviews.length;
            const averageRatingValue = reviewCountValue > 0
                ? (reviews.reduce((sum, review) => sum + review.rating, 0) / reviewCountValue).toFixed(1)
                : '0';

            reviewTitle.textContent = `${reviewCountValue} Reviews`;
            averageRating.textContent = averageRatingValue;
            reviewCount.textContent = `( Based on ${reviewCountValue} reviews )`;

            // Clear existing reviews
            reviewList.innerHTML = '';

            if (reviews.length > 0) {
                reviews.forEach(review => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <figure class="comment-thumb">
                            <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-4.0.3&auto=format&fit=crop&w=60&h=60&q=80" alt="User Avatar">
                        </figure>
                        <div class="comment-content">
                            <div class="comment-header">
                                <h5 class="author-name">${review.name || 'Anonymous'}</h5>
                                <span class="post-on">${new Date(review.date).toDateString()}</span>
                                <div class="rating-wrap">
                                    <div class="rating-start" title="Rated ${review.rating} out of 5">
                                        ${Array(5).fill().map((_, i) => `<i class="fas fa-star ${i < review.rating ? 'filled' : ''}"></i>`).join('')}
                                    </div>
                                </div>
                            </div>
                            <p>${review.comment || 'No comment provided.'}</p>
                        </div>
                    `;
                    reviewList.appendChild(li);
                });
            } else {
                reviewList.innerHTML = `
                    <li>
                        <div class="comment-content bg-white">
                            <div class="comment-header">
                                <h5 class="author-name">No Reviews Yet</h5>
                                <span class="post-on">N/A</span>
                            </div>
                            <p>Be the first to leave a review for this package!</p>
                        </div>
                    </li>
                `;
            }
        }

        // Handle star rating hover and selection
        const ratingInputs = document.querySelectorAll('.package-rate input[type="radio"]');
        const ratingLabels = document.querySelectorAll('.package-rate label');

        function updateStarRating(upToIndex) {
            ratingLabels.forEach((label, index) => {
                if (index <= upToIndex) {
                    label.classList.add('filled');
                } else {
                    label.classList.remove('filled');
                }
            });
        }

        // Handle click/selection
        ratingInputs.forEach((input, index) => {
            input.addEventListener('change', () => {
                updateStarRating(index);
            });
        });

        // Handle hover
        ratingLabels.forEach((label, index) => {
            label.addEventListener('mouseenter', () => {
                updateStarRating(index);
            });
            label.addEventListener('mouseleave', () => {
                // Restore stars based on the currently selected radio input
                const selectedInput = document.querySelector('.package-rate input[type="radio"]:checked');
                const selectedIndex = selectedInput ? Array.from(ratingInputs).indexOf(selectedInput) : -1;
                updateStarRating(selectedIndex);
            });
        });

        // Initialize stars based on any pre-selected rating
        const selectedInput = document.querySelector('.package-rate input[type="radio"]:checked');
        if (selectedInput) {
            const selectedIndex = Array.from(ratingInputs).indexOf(selectedInput);
            updateStarRating(selectedIndex);
        }

        // Handle review form submission
        document.getElementById('review-form').addEventListener('submit', function (e) {
            e.preventDefault();
            const formData = new FormData(this);
            const data = Object.fromEntries(formData);

            // Ensure rating is a number
            data.rating = parseInt(data.rating);

            fetch('/review/<%= package._id %>', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            })
                .then(response => response.json())
                .then(data => {
                    const messageEl = document.getElementById('review-message');
                    messageEl.textContent = data.message;
                    messageEl.classList.add(data.message.includes('successfully') ? 'success' : 'error');
                    messageEl.style.display = 'block';

                    if (data.message.includes('successfully')) {
                        // Add new review to the reviews array
                        reviews.push({
                            name: data.review.name,
                            rating: data.review.rating,
                            comment: data.review.comment,
                            date: new Date(),
                        });
                        document.getElementById('review-form').reset();
                        renderReviews(); // Update review section
                        // Reset star ratings
                        updateStarRating(-1);
                    }

                    setTimeout(() => {
                        messageEl.style.display = 'none';
                        messageEl.classList.remove('success', 'error');
                    }, 3000);
                })
                .catch(error => {
                    console.error('Error submitting review:', error);
                    const messageEl = document.getElementById('review-message');
                    messageEl.textContent = 'Error submitting review';
                    messageEl.classList.add('error');
                    messageEl.style.display = 'block';
                    setTimeout(() => {
                        messageEl.style.display = 'none';
                        messageEl.classList.remove('error');
                    }, 3000);
                });
        });

        renderReviews();
    </script>
</body>
</html>