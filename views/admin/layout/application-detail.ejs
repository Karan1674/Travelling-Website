<!doctype html>
<html lang="en">
<%- include('../partials/Header') %>
<body>
    <div id="container-wrapper">
        <div id="dashboard" class="dashboard-container">
            <%- include('../partials/Navbar') %>
            <%- include('../partials/Sidebar') %>
            <div class="db-info-wrap" >
                <div class="row">
                    <div class="col-lg-12">
                        <div class="dashboard-box" style="background: #ffffff; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); padding: 24px;">
                            <!-- Header -->
                            <div class="header-controls" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                                <h4 style="margin: 0; color: #1f2937; font-size: 28px; font-weight: 700; line-height: 1.2;">Application Details</h4>
                                <a href="/career-detail/<%= application.careerId._id %>" class="btn btn-secondary" style="padding: 10px 20px; border-radius: 8px; font-weight: 500; transition: all 0.3s ease;" aria-label="Back to career detail">Go to Career Detail</a>
                            </div>
            
                        
            
                            <!-- Application Details Card -->
                            <div class="card" style="border: none; border-radius: 12px;4 background: #f9fafb; padding: 24px; box-shadow: 0 2px 6px rgba(0,0,0,0.05);">
                                <div class="row" style="row-gap: 16px;">
                                    <!-- Left Column -->
                                    <div class="col-md-6">
                                        <div style="display: flex; align-items: center; margin-bottom: 16px;">
                                            <i class="fas fa-user" style="color: #6b7280; margin-right: 8px;"></i>
                                            <p style="margin: 0;"><strong style="color: #1f2937; font-weight: 600;">Applicant Name:</strong> <%= application.userId ? `${application.userId.firstName} ${application.userId.lastName}` : 'Unknown' %></p>
                                        </div>
                                        <div style="display: flex; align-items: center; margin-bottom: 16px;">
                                            <i class="fas fa-envelope" style="color: #6b7280; margin-right: 8px;"></i>
                                            <p style="margin: 0;"><strong style="color: #1f2937; font-weight: 600;">Email:</strong> <%= application.userId?.email || 'N/A' %></p>
                                        </div>
                                        <div style="display: flex; align-items: center; margin-bottom: 16px;">
                                            <i class="fas fa-briefcase" style="color: #6b7280; margin-right: 8px;"></i>
                                            <p style="margin: 0;"><strong style="color: #1f2937; font-weight: 600;">Job Title:</strong> <%= application.careerId?.title || 'N/A' %></p>
                                        </div>
                                        <div style="display: flex; align-items: center; margin-bottom: 16px;">
                                            <i class="fas fa-calendar-alt" style="color: #6b7280; margin-right: 8px;"></i>
                                            <p style="margin: 0;"><strong style="color: #1f2937; font-weight: 600;">Applied At:</strong> <%= new Date(application.appliedAt).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' }) %></p>
                                        </div>
                                  

                                          
                                      
                                        <div style="display: flex; align-items: center; margin-bottom: 16px;">
                                            <i class="fas fa-file-download" style="color: #6b7280; margin-right: 8px;"></i>
                                            <p style="margin: 0;"><strong style="color: #1f2937; font-weight: 600;">CV:</strong> 
                                                <% if (application.cvFileName) { %>
                                                    <a href="/Uploads/careerCV/<%= application.cvFileName %>" download class="text-blue-600 hover:underline" style="transition: color 0.2s ease;">Download CV</a>
                                                <% } else { %>
                                                    No CV
                                                <% } %>
                                            </p>
                                        </div>
                                    </div>
                                    <!-- Right Column -->
                                    <div class="col-md-6">
                                        <div style="display: flex; align-items: center; margin-bottom: 16px;">
                                            <i class="fas fa-info-circle" style="color: #6b7280; margin-right: 8px;"></i>
                                            <p style="margin: 0;"><strong style="color: #1f2937; font-weight: 600;">Status:</strong> 
                                                <span class="badge" style="padding: 8px 12px; border-radius: 999px; font-size: 14px; <%= application.status === 'accepted' ? 'background: #22c55e; color: #fff;' : application.status === 'rejected' ? 'background: #ef4444; color: #fff;' : 'background: #facc15; color: #1f2937;' %>">
                                                    <%= application.status.charAt(0).toUpperCase() + application.status.slice(1) %>
                                                </span>
                                            </p>
                                        </div>

                                        <div style="display: flex; align-items: center; margin-bottom: 16px;">
                                        <% if(application.updatedBy) {%>
                                            <p style="margin: 0;">
                                                <i class="fas fa-envelope" style="color: #6b7280; margin-right: 8px;"></i>
                                                <strong style="color: #1f2937; font-weight: 600;">Updated By:</strong>
                                                <%= application.updatedBy ?
                                                    `${application.updatedBy.firstName}
                                                    ${application.updatedBy.lastName}
                                                    (${application.updatedBy.email})` : 'Unknown' %>
                                            </p>
                                            <% } %>
                                        </div>
                                            <div style="display: flex; align-items: center; margin-bottom: 16px;">
                                                <% if(application.updatedAt) {%>
                                                    <p style="margin: 0;">
                                                        <i class="fas fa-calendar-alt" style="color: #6b7280; margin-right: 8px;"></i>
                                                        <strong style="color: #1f2937; font-weight: 600;">Updated
                                                            At:</strong>
                                                        <%= new
                                                            Date(application.updatedAt).toLocaleDateString('en-US',
                                                            { year: 'numeric' , month: 'long' ,
                                                            day: 'numeric' }) %>
                                                    </p>
                                                    <% } %>
                                            </div>
                                    </div>
                                </div>
            
                                <!-- CV Preview Section -->
                                <% if (application.cvFileName) { %>
                                    <div style="margin-top: 32px;">
                                        <h5 style="color: #1f2937; font-weight: 600; font-size: 20px; margin-bottom: 16px;">CV Preview</h5>
                                        <% if (application.cvFileName.match(/\.(jpe?g|png)$/i)) { %>
                                            <img src="/Uploads/careerCV/<%= application.cvFileName %>" alt="CV Preview" style="max-width: 100%; max-height: 600px; border-radius: 8px; border: 1px solid #e5e7eb; object-fit: contain;">
                                        <% } else if (application.cvFileName.match(/\.(pdf)$/i)) { %>
                                            <iframe src="/Uploads/careerCV/<%= application.cvFileName %>" style="width: 100%; height: 600px; border-radius: 8px; border: 1px solid #e5e7eb;" title="CV Preview"></iframe>
                                        <% } else { %>
                                            <p style="color: #6b7280;">Preview not available for this file type (DOC/DOCX). Please <a href="/Uploads/careerCV/<%= application.cvFileName %>" download class="text-blue-600 hover:underline">download the CV</a> to view.</p>
                                        <% } %>
                                    </div>
                                <% } %>
            
                                <!-- Status Update Form -->
                                <div style="margin-top: 32px;">
                                    <h5 style="color: #1f2937; font-weight: 600; font-size: 20px; margin-bottom: 16px;">Update Application Status</h5>
                                    <form action="/application-detail/<%= application._id %>/update" method="POST" class="needs-validation" novalidate>
                                        <div style="margin-bottom: 24px;">
                                            <label for="status" style="color: #1f2937; font-weight: 500; display: block; margin-bottom: 8px;">Select Status</label>
                                            <select class="form-select" id="status" name="status" required style="padding: 12px; border-radius: 8px; border: 1px solid #d1d5db; width: 100%; font-size: 16px;">
                                                <option value="" disabled <%= !application.status ? 'selected' : '' %>>Select a status</option>
                                                <option value="pending" <%= application.status === 'pending' ? 'selected' : '' %>>Pending</option>
                                                <option value="accepted" <%= application.status === 'accepted' ? 'selected' : '' %>>Accepted</option>
                                                <option value="rejected" <%= application.status === 'rejected' ? 'selected' : '' %>>Rejected</option>
                                            </select>
                                            <div class="invalid-feedback" style="color: #ef4444; font-size: 14px; margin-top: 4px;">
                                                Please select a status.
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-primary" style="padding: 10px 20px; border-radius: 8px; background: #3b82f6; color: #fff; font-weight: 500; transition: background 0.3s ease;">Update Status</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <%- include('../partials/Footer') %>
        </div>
    </div>
    <%- include('../../shared/partials/toaster') %>
    <%- include('../partials/script.ejs') %>
</body>
</html>